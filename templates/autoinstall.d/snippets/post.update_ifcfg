{# NOTE: ifcfg-ethX must not be saved as ifcfg-ethX.save #}{% for ni in interfaces %}
{%-     if ni.nodns is defined %}
f=/etc/sysconfig/network-scripts/ifcfg-{{ ni.device }}
bf=/etc/sysconfig/network-scripts/saved.ifcfg-{{ ni.device }}
if `grep -q PEERDNS=yes $f 2>/dev/null`; then
    cp $f $bf
    sed -i -e 's/PEERDNS=.*/PEERDNS=no/' $f
else  # It should be a bug in anaconda...
    cp $f $bf
    echo "PEERDNS=no" >> $f
fi
{%-     endif -%}
{%  endfor %}
