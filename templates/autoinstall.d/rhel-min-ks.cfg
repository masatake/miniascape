{# Jinja2 (http://jinja.pocoo.org) based kickstart template for RHUI. #}# see also: http://red.ht/hvPnf3
{% block ks_options %}
{%-  block install_method %}
text
{%-  endblock %}
{%-  block basic_options %}
{%-     block authconfig %}
authconfig --enableshadow {% if auth.options is defined %}{{ auth.options }}{% else %}--passalgo=sha512{% endif %}
{%-     endblock %}
{%-     block bootloader %}
bootloader --location=mbr
{%-     endblock %}
keyboard {{ keyboard|default('us') }}
lang {{ lang|default('en_US.UTF-8') }}
rootpw  {{ rootpw|default('redhat') }}
selinux --{{ selinux|default('enforcing') }}
timezone {% if timezone.utc %}--utc{% endif %} {{ timezone.timezone|default('Asia/Tokyo') }}
skipx
{% if ks_finish is defined %}{{ ks_finish }}{% else %}poweroff{% endif %}
{%-  endblock %}
{%-  block extra_options %}
{%     for repo in ks_repos -%}
repo --name="{{ repo.name }}" --baseurl={{ repo.baseurl }}
{%     endfor -%}{#     TODO:
{%     for user in ks.users %}user --name=...
{%     endfor %} #}
{%-  endblock %}
{%-  block firewall %}firewall --enabled --ssh
{%-  endblock %}
{%-  block services %}
services --disabled cups,gpm,iscsi,iscsid,ip6tables,kudzu,lm_sensors,lvm2-monitor,mcstrans,mdmonitor,netfs,portreserve,rhnsd
{%-  endblock %}
{%-  block network %}
{%-    for ni in interfaces %}
network --device={{ ni.device }} --bootproto={{ ni.bootproto|default('dhcp') }} --onboot={{ ni.onboot|default('yes') }}
{%-      if ni.bootproto == 'static' %} --ip={{ ni.ip }} --netmask={{ ni.netmask|default('255.255.255.0') }}
{%-        if ni.gateway is defined %} --gateway={{ ni.gateway }}{% endif -%}
{%-        if ni.nameserver is defined %} --nameserver={{ ni.nameserver }}{% endif -%}
{%-      endif -%}
{%-      if ni.nodns is defined %} --nodns{% endif -%}
{%-      if ni.options %} {{ ni.options }}{% endif -%}
{%     endfor %}
{%-  endblock %}
{%-  block partition %}
zerombr
clearpart --all --initlabel
autopart
{%-  endblock %}
{%- endblock %}

%packages
{%- block packages %}
{%-   block packages_installed %}
{%      include "data/rhel_basic_tools_rpms" %}
{%-   endblock -%}
{%-   block packages_not_installed %}
{%      include "data/rhel_uninstalled_rpms" %}
{%-   endblock %}
{%- endblock %}


%pre
{%- block pre_wrapped %}
{%-   block pre %}
{%      include "snippets/pre.logging" %}
{# {%   include "snippets/pre.store_cmdline" %} #}
{%-   endblock %}
{%- endblock %}


%post --nochroot
{%- block post_nochroot_wrapped %}
{%-   block post_nochroot %}
{%-   endblock %}
{%- endblock %}


%post
{%- block post_wrapped %}
{%-   block post %}
{%      include "snippets/post.logging" %}
{%      include "snippets/post.import_rhel_gpgkey" %}
{%      include "snippets/post.add_peerdns_no_into_ifcfg" %}
{%-   endblock %}
{%- endblock %}
