{#- Jinja2 (http://jinja.pocoo.org) based kickstart template for RHEL guests. -#}
# see also: http://red.ht/hvPnf3
{% block kickstart_options -%}
install
{%   block location -%}
{%     if kickstart.install is defined and kickstart.install -%}
{{        kickstart.install }}
{%-    else -%}
url --url {{ virtinst.location }}
{%     endif -%}
{%-  endblock %}
{%   block install_method -%}
text
{%-  endblock %}
{%   block authconfig -%}
authconfig --enableshadow {% if auth.options is defined %}{{ auth.options }}{% endif -%}
{%   endblock %}
{%   block bootloader -%}
{%       include "snippets/ks/main.bootloader" -%}
{%   endblock %}
{%   block keyboard -%}
keyboard {{ keyboard|default('us') }}
{%   endblock -%}
lang {{ lang|default('en_US.UTF-8') }}
rootpw {{ rootpw|default('secret') }}
selinux --{{ selinux|default('enforcing') }}
{%   block timezone -%}
timezone
{{-     " --utc" if timezone.utc -}}
{{-     " %s" % timezone.timezone|default('Asia/Tokyo') }}
{%-  endblock %}
skipx
{{   kickstart.finish|default('poweroff') }}
{%   include "snippets/ks/main.yum_repos" -%}
{%   include "snippets/ks/main.groups" -%}
{%   include "snippets/ks/main.users" -%}
{%   block firewall -%}
{%       include "snippets/ks/main.firewall" -%}
{%   endblock %}
{%   include "snippets/ks/main.services" -%}
{%   block network -%}
{%      if kickstart and kickstart.dynamic_network -%}
{{          "%include /tmp/network-ks.cfg" }}
{%      else -%}
{%          include "snippets/ks/main.network" -%}
{%      endif %}
{%   endblock %}
{%   block partition -%}
{%       include "snippets/ks/main.partitions" -%}
{%   endblock %}
{% endblock %}

%packages {{ kickstart.packages_options|default('--ignoremissing') }}
{% block packages -%}
{%   block packages_installed -%}
{%     include "data/rhel_basic_tools_rpms" %}
{%     if packages is defined and packages.add is defined -%}
# Added:
{%       for p in packages.add %}{{ p }}
{%       endfor -%}
{%     endif -%}
{%   endblock %}
{%   block packages_not_installed -%}
{%     include "data/rhel_uninstalled_rpms" %}
{%   endblock -%}
{% endblock %}

%pre
{% block pre_wrapped -%}
{%   block pre -%}
{%      include "snippets/pre.logging" %}
{%      if kickstart and kickstart.dynamic_network -%}
{%          include "snippets/pre.store_cmdline" %}
{%          include "snippets/pre.dynamic_network" %}
{%      else -%}
{%          if store_cmdline -%}
{%              include "snippets/pre.store_cmdline" %}
{%          endif -%}
{%      endif -%}
{%      for snippet in kickstart.pre_snippets -%}
{{          snippet }}
{%      endfor %}
{%   endblock -%}
{% endblock %}

%post --nochroot
{% block post_nochroot_wrapped -%}
{%   block post_nochroot -%}
{%   endblock -%}
{% endblock %}

%post
{% block post_wrapped -%}
{%   block post -%}
{%      include "snippets/post.logging" %}
{%      include "snippets/post.import_rhel_gpgkey" %}
{%      include "snippets/post.setup_yum_repos" %}
{%      for ni in interfaces if ni.bootproto == 'dhcp' -%}
{%          if loop.first -%}
# Network config files anaconda generated will be used...
{% endif -%}
{%      else -%}
{%          include "snippets/post.generate_etc_sysconfig_network_files" %}
{%          include "snippets/post.generate_resolv.conf" %}
{%      endfor %}
{%      if ntpservers is defined and ntpservers -%}
{%          include "snippets/post.update_ntp.conf" -%}
{%      endif %}
{%      if ssh_root_acces is defined and not ssh_root_acces -%}
{%          include "snippets/post.update_sshd_config" -%}
{%      endif %}
{%      if generate_hosts is defined and generate_hosts -%}
{%          include "snippets/post.generate_hosts" -%}
{%      endif %}
{%      if setup_screen is defined and setup_screen -%}
{%          include "snippets/post.root_screenrc" -%}
{%      endif %}
{%      include "snippets/post.custom_scripts" %}
{%   endblock -%}
{% endblock %}
