{# Jinja2 (http://jinja.pocoo.org) based kickstart template for RHUI. #}# see also: http://red.ht/hvPnf3
{% block ks_options -%}
{%   block install_method -%}
text{% endblock %}
{%   block authconfig -%}
authconfig --enableshadow {% if auth.options is defined %}{{ auth.options }}{% endif %}{% endblock %}
{%   block sshpw %}{% endblock %}
{%   block bootloader -%}
bootloader --location=mbr{% endblock %}
keyboard {{ keyboard|default('us') }}
lang {{ lang|default('en_US.UTF-8') }}
rootpw  {{ rootpw|default('redhat') }}
selinux --{{ selinux|default('enforcing') }}
timezone {% if timezone.utc %}--utc{% endif %} {{ timezone.timezone|default('Asia/Tokyo') }}
skipx
{%   if ks_finish is defined %}{{ ks_finish }}{% else -%}
poweroff{% endif %}
{%   for repo in ks_repos -%}
repo --name="{{ repo.name }}" --baseurl={{ repo.baseurl }}
{%   endfor %}{% for user in ks_users -%}
user --name={{ user.name }}
{%-      if user.groups is defined %} --groups={{ user.groups }}{% endif -%}
{%-      if user.homedir is defined %} --homedir={{ user.homedir }}{% endif -%}
{%-      if user.password is defined %} --password={{ user.password }}{% endif -%}
{%-      if user.iscrypted is defined %} --iscrypted{% endif -%}
{%-      if user.shell is defined %} --shell={{ user.shell }}{% endif -%}
{%-      if user.uid is defined %} --uid={{ user.uid }}{% endif %}
{%   endfor %}{% block firewall -%}
firewall --enabled --ssh{% endblock %}
{%   block services -%}
services {% if services.enabled is defined and services.enabled %}--enabled {{ services.enabled|join(',') }} {% endif %}--disabled {{ services.disabled|join(',') }}{% endblock %}{% block network %}{% for ni in interfaces %}
network --device={{ ni.device }} --bootproto={{ ni.bootproto|default('dhcp') }} --onboot={{ ni.onboot|default('yes') }}
{%-      if ni.bootproto == 'static' %} --ip={{ ni.ip }} --netmask={{ ni.netmask|default('255.255.255.0') }}
{%-         if ni.gateway is defined %} --gateway={{ ni.gateway }}{% endif -%}
{%-         if ni.nameserver is defined %} --nameserver={{ ni.nameserver }}{% endif -%}
{%-         if ni.fqdn is defined %} --hostname={{ ni.fqdn }}{% endif -%}
{%-      endif -%}
{%-      if ni.nodns is defined %} --nodns{% endif -%}
{%-      if ni.options %} {{ ni.options }}{% endif -%}
{%     endfor %}{% endblock %}
{%  block partition -%}
zerombr
clearpart --all --initlabel
autopart{% endblock %}
{%- endblock %}

%packages
{% block packages -%}
{%   block packages_installed -%}
{%     include "data/rhel_basic_tools_rpms" %}
{%     if packages is defined %}{% if packages.add is defined -%}
# Added:
{%       for p in packages.add %}{{ p }}
{%       endfor %}{% endif -%}
{%     if packages.remove is defined -%}
# Removed:
{%       for p in packages.remove %}{{ p }}
{%       endfor %}{% endif -%}
{%     endif -%}
{%   endblock %}
{%   block packages_not_installed -%}
{%     include "data/rhel_uninstalled_rpms" -%}
{%   endblock -%}
{% endblock %}


%pre
{% block pre_wrapped -%}
{%   block pre -%}
{%      include "snippets/pre.logging" -%}
{# {%   include "snippets/pre.store_cmdline" %} -#}
{%   endblock -%}
{% endblock %}


%post --nochroot
{% block post_nochroot_wrapped -%}
{%   block post_nochroot -%}
{%   endblock -%}
{% endblock %}


%post
{% block post_wrapped -%}
{%   block post -%}
{%      include "snippets/post.logging" %}
{%      include "snippets/post.import_rhel_gpgkey" %}
{%      include "snippets/post.add_peerdns_no_into_ifcfg" %}
{%   endblock -%}
{% endblock %}
