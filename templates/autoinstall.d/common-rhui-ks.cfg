{% extends "rhel-6-x86_64-base-ks.cfg" %}

{% block firewall %}
# Available services list: see `/usr/sbin/lokkit --list-services`
# RHUI firewall rules: http://red.ht/I3Qhwf
firewall --enabled --service=ssh,http,https --port=5674:udp --port=5674:tcp --port=snmp:tcp --port=snmp:udp{% endblock %}

{% block services %}
services --disabled ip6tables,lvm2-monitor --enabled smb,nmb,winbind{% endblock %}

{% block partition %}clearpart --all --initlabel
part swap                            --asprimary --ondisk=sda --size={{ swap }}
part /     --fstype={{ filesystem }} --asprimary --ondisk=sda --size=100 --grow
#part /data --fstype={{ filesystem }} --asprimary --ondisk=sdb --size=100 --grow
{% endblock %}

{% block packages_installed %}{{ super() }}curl
elinks
kexec-tools
vim-enhanced
PyPAM
createrepo
httpd
mod_ssl
nss-tools
python-qpid
rpm-build
# for snmp:
net-snmp
# for winbind auth:
pam_krb5
samba
samba-client
samba-winbind
samba-winbind-clients{% endblock %}

{% block post %}{{ super() }}
hostname={{ hostname }}
{% include "post.fqdn_and_nozeroconf" %}
{% include "post.resolv_conf" %}
{% include "post.rsyslog_conf" %}
{% include "post.iptables" %}
{% include "post.winbind" %}
{% include "post.snmpd_conf" %}

mkdir -p /root/setup
cat << EOF > /root/setup/post_rhui_installation.setup_dirs.sh
{% include "post_rhui_installation.setup_dirs.sh" %}
EOF

{# {% include "post.pulp" %} #}
{% endblock %}
