{% extends "rhel-min-ks.cfg" %}

{%  block timezone -%}
timezone {{ timezone.timezone|default('Asia/Tokyo') -}}
         {{- '--isUtc' if timezone.utc -}}
{%    if ntpservers -%}
--ntpservers=
{%-     for ns in ntpservers -%}
{{-       ns.hostname if ns.hostname is defined else ns.ip -}}
{{-       ','   if not loop.last -}}
{%-     endfor -%}
{%-   else %} --nontp
{%-   endif -%}
{%- endblock %}

{% block keyboard -%}
keyboard --vckeymap={{ keyboard|default('us') }} --xlayouts={{ keyboard|default('us') }}
{%- endblock %}

{% block network -%}
{{ super() }}
{{ "network --hostname=%s" % fqdn if fqdn is defined }}
{%- endblock %}

{% block kickstart_options -%}
{{ super() }}
{%    if ssh_root_access is defined and ssh_root_access -%}
sshpw --username=root {{ rootpw|default('secret') }} --plaintext
{%    endif -%}
{%- endblock %}

{# Add '%end' at the end of kickstart sections #}
{% block packages -%}
{%   block packages_installed -%}
{%     include "data/rhel-7_basic_tools_rpms" %}
{%     if packages is defined and packages.add is defined -%}
# Added:
{%       for p in packages.add %}{{ p }}
{%       endfor -%}
{%     endif -%}
{%   endblock %}
{%   block packages_not_installed -%}
{%     include "data/rhel-7_uninstalled_rpms" %}
{%   endblock -%}
%end
{%- endblock %}

{% block pre_wrapped -%}
{{ super() }}
%end
{%- endblock %}

{% block post_nochroot_wrapped -%}
{{ super() }}
%end
{%- endblock %}

{% block post_wrapped -%}
{%   block post -%}
{%      include "snippets/post.logging" %}
{%      include "snippets/post.import_rhel_gpgkey" %}
{%      include "snippets/post.setup_yum_repos" %}
{%      include "snippets/post.setup_proxy_for_rhsm" %}
{%      for ni in interfaces if ni.bootproto == 'dhcp' -%}
{%          if loop.first -%}
# Network config files anaconda generated will be used...
{% endif -%}
{%      else -%}
{%          include "snippets/post.generate_etc_sysconfig_network_files" %}
{%          include "snippets/post.generate_resolv.conf" %}
{%      endfor %}
{%      if ssh_root_acces is defined and not ssh_root_acces -%}
{%          include "snippets/post.update_sshd_config" -%}
{%      endif %}
{%      if generate_hosts is defined and generate_hosts -%}
{%          include "snippets/post.generate_hosts" -%}
{%      endif %}
{%      if setup_screen is defined and setup_screen -%}
{%          include "snippets/post.root_screenrc" -%}
{%      endif %}
{%   endblock -%}
{%   if use_serial_console is defined and use_serial_console -%}
{%     include "snippets/post.serial_console.systemd" -%}
{%   endif %}
{%   if enable_sysrq is defined and enable_sysrq -%}
{%     include "snippets/post.enable_sysrq_rhel6" -%}
{%   endif %}
{%   if disable_reboot is defined and disable_reboot -%}
{%     include "snippets/post.disable_reboot_with_ctrl_alt_del.systemd" -%}
{%   endif %}
{%   import "snippets/post.embed_base64_file" as E -%}
{{   E.embed_base64_file(setup_data) }}
%end
{%- endblock %}
