#! @PYTHON@
#
# Copyright (C) 2010 Satoru SATOH <satoru.satoh at gmail.com>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3, or (at your option)
# any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software Foundation,
# Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
#

import errno
import logging
import optparse
import os
import sys

import miniascape as m

from miniascape.globals import PKG_CONFIG_PATH, PKG_SYSCONFDIR, PKG_DATADIR



def install(domain_name, config_path=PKG_CONFIG_PATH):
    """Install guest domain.
    """
    if m.virt.is_libvirtd_running(m.svc_libvirtd(self.config_path)):
                                conn = connect()
                                                try:
                                                                    dom = conn.lookupByName(name)
                                                                                        self.xml = dom.XMLDesc(0)
                                                                                                            self.status = dom.info()[0]

                                                                                                                            except libvirt.libvirtError:
                                                                                                                                                raise RuntimeError(" Domain not found: '%s'" % name)
                                                                                                                                                 
    if svc_libvirtd():
        conn = ...
        conn.define(domain_name)
    else:
        ...

def update(domain_name):
    ...


def uinstall(domain_name):

    /sbin/service libvirtd status >/dev/null 2>&1 && \
        (@VIRSH@ undefine @DOMAIN_NAME@ && @VIRSH@ define %{domain_xml}) || :
fi


def main():
    p = optparse.OptionParser("%prog [OPTION ...] DOMAIN_NAME")
    p.add_option('-C', '--conf', help='Config file [%default]', default=PKG_CONFIG_PATH)
    p.add_option('', '--dry-run', help='Do not actually perform task', default=False, action="store_true")
    p.add_option('-s', '--silent', help='Silent mode', default=False, action="store_true")
    (options, args) = p.parse_args()

    if len(args) < 1:
        p.print_help()
        sys.exit(errno.EINVAL)

    conf = args[0]
    rc = 0

    c = miniascape.config.init(options.conf)
    virtinst = c.commands.virt_install
    siteconf = c.virtinst.site_config

    if options.template:
        tmpl = options.template
    else:
        tmpl = c.virtinst.template

    cmd = virtinst_cmd(options.siteconf, conf, tmpl)



# vim:sw=4:ts=4:et:ft=python:
