#! /bin/bash
set -e

prefix=@prefix@
libexecdir=@libexecdir@

confdir=@sysconfdir@/@PACKAGE@/networks
tmpldir=@datadir@/@PACKAGE@/templates/networks
outdir=@localstatedir@/@PACKAGE@/networks

virsh=@VIRSH@


for net in net-1 net-2 net-3; do \

    # files:
    conf=$confdir/$net.yaml
    netxml_tmpl=$tmpldir/net-x.xml.tmpl
    dnsmasq_conf_tmpl=$tmpldir/dnsmasq/net-x.conf.tmpl
    dnsmasq_hostsfile_tmpl=$tmpldir/dnsmasq/net-x.hostsfile.tmpl
    netxml=$outdir/$net.xml
    dnsmasq_conf=$outdir/dnsmasq/$net.conf
    dnsmasq_hostsfile=$outdir/dnsmasq/$net.hostsfile

    dnsmasq=dnsmasq-$net

    # 1. re-create network xml
    $libexecdir/net-configure.py --conf $conf \
        --netxml-template $netxml_tmpl --dnsmasq-conf-template $dnsmasq_conf_tmpl \
            --dnsmasq-hostsfile-template $dnsmasq_hostsfile_tmpl \
        --netxml $netxml --dnsmasq-conf $dnsmasq_conf --dnsmasq-hostsfile $dnsmasq_hostsfile \
        $net

    # 2. re-register network
    $libexecdir/net-register $netxml
done

# vim: set sw=4 ts=4 et:
