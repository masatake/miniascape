public_network: &public_network openshift-public

networks:
  - name: &openshift_network_0 openshift-network
    mode: nat
    domain: &domain openshift.example.com
    gateway: &gateway 192.168.210.254
    netmask: &netmask 255.255.255.0
    network: 192.168.210.0

common:
  domain: *domain
  gateway: *gateway
  netmask: *netmask

  nameservers:
    - hostname: &broker_1_ip 192.168.210.11

  store_cmdline: false

  redhat:
    subscription:
      pool:

  virtinst:
    location: /var/lib/libvirt/images/rhel-server-6.6-x86_64-dvd.iso

  # see: OSE Deployment Guide, 2.3. Red Hat Subscription Requirements:
  # http://red.ht/1ExJoRz
  repos:
    - rhel-6-server-rpms                      # Red Hat Enterprise Linux 6
    - rhel-server-rhscl-6-rpms                # Red Hat Software Collections (1)
    - rhel-6-server-ose-2.2-infra-rpms        # Red Hat OpenShift Enterprise Infrastructure
    - rhel-6-server-ose-2.2-node-rpms         # Red Hat OpenShift Enterprise Application Node
    - rhel-6-server-ose-2.2-rhc-rpms          # Red Hat OpenShift Enterprise Client Tools
    - rhel-6-server-ose-2.2-jbosseap-rpms     # Red Hat OpenShift Enterprise JBoss EAP add-on
    - jb-ews-2-for-rhel-6-server-rpms         # JBoss Enterprise Web Server 2
    - jb-eap-6-for-rhel-6-server-rpms         # JBoss Enterprise Application Platform 6
    # These are optional?:
    - rhel-6-server-ose-2.2-jbossamq-rpms     # Red Hat OpenShift Enterprise 2.2 JBoss A-MQ add-on
    - rhel-6-server-ose-2.2-jbossfuse-rpms    # Red Hat OpenShift Enterprise 2.2 JBoss FUSE add-on

  openshift:
    domain: *domain
    hosts_domain: apps.openshift.example.com
    broker_hostname: &broker_1_hostname ose-broker-1
    broker_ip: *broker_1_ip
    activemq_ip: *broker_1_ip
    nodes:
      - hostname: &ose_node_1_hostname ose-node-1
        ip: &ose_node_1_ip 192.168.210.21

      - hostname: &ose_node_2_hostname ose-node-2
        ip: &ose_node_2_ip 192.168.210.22

    # valid_gear_sizes: small
    # default_gear_size: small
    # default_gear_capabilities: small
    # mcollective_password:
    # mongodb_broker_password:
    # openshift_password1:


guests:
  - name: ose-broker
    description: OpenShift Enterprise Broker
    templates:
      autoinst:
        src: autoinstall.d/openshift-broker-ks.cfg

    setup_screen: true

    firewall:
      rules:
        - http
        - "port=443:tcp"
        - "port=27017:tcp"
        - "port=61613:tcp"
        - "port=61616:tcp"
        - "port=53:tcp"
        - "port=53:udp"

    openshift:
      install_components:
        - broker
        - named
        - activemq
        - datastore

    guests:
      - hostname: *broker_1_hostname
        fqdn: ose-broker-1.openshift.example.com
        ip: *broker_1_ip
        interfaces:
          - mac: "52:54:00:21:00:11"
            network: *openshift_network_0

  - name: ose-node
    description: OpenShift Enterprise node
    templates:
      autoinst:
        src: autoinstall.d/openshift-node-ks.cfg

    firewall:
      rules:
        - http
        - "port=443:tcp"
        - "port=8000:tcp"
        - "port=8443:tcp"
      input_rules:
        - "-A INPUT -m state --state NEW -m tcp -p tcp --dport 2303:2308 -j ACCEPT"
        - "-A INPUT -m state --state NEW -m tcp -p tcp --dport 35531:65535 -j ACCEPT"

    openshift:
      install_components:
        - node
      cartridges:
        - php
        - ruby
        - haproxy

    guests:
      - hostname: *ose_node_1_hostname
        ip: *ose_node_1_ip
        fqdn: ose-node-1.openshift.example.com
        interfaces:
          - mac: "52:54:00:21:00:21"
            network: *openshift_network_0

        openshift:
          node_hostname: *ose_node_1_hostname

      - hostname: *ose_node_2_hostname
        ip: *ose_node_2_ip
        fqdn: ose-node-2.openshift.example.com
        interfaces:
          - mac: "52:54:00:21:00:22"
            network: *openshift_network_0

        openshift:
          node_hostname: *ose_node_2_hostname

# vim:sw=2:ts=2:et:
