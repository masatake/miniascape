====================
miniascape
====================

This package contains a collection of libvirt network and other core service
configurations, and build tools for packaged vms.


Prerequisites
============================

 * virsh in libvirt
 * qemu-img
 * virt-install in python-virtinst
 * nfs-utils [option]
 * scsi-target-utils (tgtd) [option]
 * etc.


Build
============================

 [autoreconf -vfi]
 ./configure


Installation
============================

 make 
 make install


Create [S]RPM
============================

 make srpm && mock *.rpm


What should be done after installation and updates
=========================================================

* post installation:

  * run '/usr/libexec/miniascape/net-manage-all install'
  * add the following line in the middle of /etc/auto.master:

    /srv/iso-contents /etc/auto.iso

* post update:

  * run '/usr/libexec/miniascape/net-manage-all update'

And optionally, add host entries in /usr/share/libvirt/networks/hosts.add
into /etc/hosts or add host entries in your .ssh/config if you want.


What should be done before uninstallation
=========================================================

* pre uninstallation: run uninstall.sh

or if you forgot to run '/usr/libexec/miniascape/net-manage-all uninstall'
before uninstallation, do the followings after that.

::

    for net in net-1 net-2 net-3; do
        virsh net-destroy $net && virsh net-undefine $net
    done



FAQ
========================

Q1. Installation looks completed but an error messsage "ERROR 'VirtualDisk'
    object has no attribute 'DRIVER_TYPE_RAW' ..." was printed.
    What's goin' on?

A1. That's a virt-install's bug. Go
    https://bugzilla.redhat.com/show_bug.cgi?id=628721 and apply the patch.




TODO
=========================

* RHEL 3/4: installtion fails because installer cannot get netstg2.img even if
  it exists and able to be downloaded with curl, etc. The problem looks
  identical to the issue reported here:
  http://www.redhat.com/archives/kickstart-list/2005-December/msg00026.html


* profile: hw profile came from profile data, e.g. profiles/rhel-5-5-vm-1.cfg
  * autoinst: kickstart/preseed config, e.g. autoinstall/rhel-5-cluster.ks.cfg
  * net: ip, mac and hostname [, cname, ...]

* network configuration update based on per guest configurations such like:

::

    hosts = []

    for f in glob.glob("vm.d/*/net"):
        hosts += (ip,mac,hostname) = open(f).read().split()

    ... (dump network xml with all host entries added) ...


* Genaral tunings (timer, io scheduler, virtio, etc.) for both guest and host.

* python-virtinst (upstream) fixes
  * image format error (someone's fix was merged in upstream but not yet released.) 
  * it may be difficult but it should be great if --initrd-inject could work with --cdrom [Maybe]

* --config (or --profile?) file option for virt-install [Should]

* enhancement for qemu-img to get base image path of delta image [Should]

* more D-Bus APIs for dnsmasq to simplify the control process of dnsmasq and make it dynamic [Should]


TODO (In progress)
----------------------------------

* Setup console access to guest domain


TODO (Done)
----------------------------------

* dnsmasq backend for libvirt [libvirt upstream]

* apache -> nginx transition

* python-virtinst (upstream) fixes
  * perms=rw storage option is not handled correctly: my patch was migrated.
    [python-virtinst upstream]

* per guest configurations: vm.d/<VM Name>/{profile,autoinst,net,...}

* Genaral tunings (timer, io scheduler, virtio, etc.) for both guest and host: Partially done
  * cache=none will be enabled in domain xml



License
=========================

This is distributed under GPLv3+ license tentatively.


Author
=========================

Satoru SATOH <satoru.satoh@gmail.com>
