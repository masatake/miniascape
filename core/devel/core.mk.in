#
# Driver makefile for vmbuild.
#

pkglibdir = @pkgdatadir@/devel


# Load global defaults
include $(pkglibdir)/vars.mk


# Load VM specific data
ifeq ($(miniascape_CONFIG),)
$(error You must specify miniascape_CONFIG)
endif

include $(miniascape_CONFIG)


# Load library makefiles:
include $(pkglibdir)/disk.mk
include $(pkglibdir)/network.mk
include $(pkglibdir)/virtinst.mk


WORKDIR	= $(shell pwd)/$(miniascape_NAME)-build

include $(pkglibdir)/rpm.mk


# targets:
prebuild: $(WORKDIR)/prebuild.stamp

build: $(WORKDIR)/build.stamp

build-vm: $(WORKDIR)/prebuild.stamp
	$(miniascape_VIRTINST) $(virtinst_FLAGS)

install: build

$(WORKDIR)/prebuild.stamp: $(disk_images)
	touch $@

$(WORKDIR)/build.stamp: build-vm
	touch $@

#rpm: $(WORKDIR)/rpm.stamp
#srpm: $(WORKDIR)/srpm.stamp

#$(WORKDIR)/rpm.stamp: $(WORKDIR)/build.stamp
#$(WORKDIR)/srpm.stamp: $(WORKDIR)/build.stamp


all-clean:
	rm -f $(WORKDIR)/*.stamp

.PHONY: prebuild build install all-clean rpm srpm
# vim:set ft=make ai si sm:
