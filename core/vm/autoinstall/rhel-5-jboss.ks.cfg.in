# RHEL 5
url --url=@AUTOINST_TREE_URL_BASE@/RHEL/5/6/Server/i386/
install
text
lang en_US.UTF-8
keyboard us
skipx
auth --useshadow --enablemd5
firewall --enabled --ssh --http --port=8080:tcp
firstboot --disable
network --device=eth0 --bootproto=dhcp
network --device=eth1 --bootproto=dhcp --onboot=no --nodns
network --device=eth2 --bootproto=dhcp --nodns
network --device=eth3 --bootproto=dhcp --onboot=no --nodns
rootpw --iscrypted $1$u3qutDHb$7APw4U/78XZW44uPsoNa41
selinux --disabled
timezone  Asia/Tokyo
zerombr
bootloader --location=mbr
clearpart --all --initlabel
autopart
key --skip
services --disabled atd,cups,gpm,ip6tables,lm_sensors,mcstrans,mdmonitor,ntpd,restorecond,sendmail,smartd,rhnsd
reboot

# repos
#repo --name=rhel-kstree --baseurl=@AUTOINST_TREE_URL_BASE@/RHEL/5/5/Server/i386/Server/


%pre


%packages
# Automatic package selection.
@ Base
avahi
curl
elinks
#kernel-devel
lv
ntp
rpm-build
screen
strace
#systemtap
vim-enhanced
#kexec-tools
#system-config-kdump
#
# JBoss specific
tomcat5
tomcat5-webapps
tomcat5-jsp-2.0-api
tomcat5-servlet-2.4-api
java-1.6.0-openjdk
java-1.6.0-openjdk-devel
#
-Deployment_Guide-en-US
-NetworkManager
-OpenIPMI
-OpenIPMI-libs
-acpid
-amtu
-apmd
-aspell
-aspell-en
-bluez-gnome
-bluez-libs
-bluez-utils
-ccid
-conman
-coolkey
-cpuspeed
-dos2unix
-eject
-fbset
-finger
-ftp
-hdparm
-ifd-egate
-irda-utils
-irqbalance
-krb5-workstation
-microcode_ctl
-mozldap
-nano
-pam_pkcs11
-pam_ccreds
-pam_smb
-pcmciautils
-pcsc-lite
-ppp
-psacct
-rdate
-rdist
-redhat-release-notes-5Server
-rp-pppoe
-rsh
-specspo
-stunnel
-talk
-telnet
-udftools
-unix2dos
-wpa_supplicant
-yum-updatesd


%post --nochroot
cp /tmp/ks.cfg /mnt/sysimage/root/


%post
cat << EOF >> /etc/sysconfig/network
GATEWAYDEV=eth0
EOF

rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release

cat << EOF > /etc/yum.repos.d/rhel-kstree.repo
[rhel-kstree]
name=Red Hat Enterprise Linux $releasever - $basearch - Server (kickstart tree)
baseurl=@AUTOINST_TREE_URL_BASE@/RHEL/5/5/Server/i386/Server/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF


cd /root
curl -O @AUTOINST_TREE_URL_BASE@/JBEAP-5/5.1.0/jboss-eap-5.1.0.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBEAP-5/5.1.0/jboss-ep-native-5.1.0-RHEL5-i386.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBEAP-5/5.1.0/jboss-ep-ws-cxf-5.1.0-installer.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBossON/2.4.0/jon-license.xml
curl -O @AUTOINST_TREE_URL_BASE@/JBossON/2.4.0/jon-plugin-pack-eap-2.4.0.GA.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBossON/2.4.0/jon-plugin-pack-ews-2.4.0.GA.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBossON/2.4.0/jon-plugin-pack-soa-2.4.0.GA.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBossON/2.4.0/jon-server-2.4.0.GA.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBossEPP/5.0.1/jboss-epp-5.0.1.GA.zip
curl -O @AUTOINST_TREE_URL_BASE@/JBossBRMS/5.0.0/jboss-brms-5.0.0.zip


