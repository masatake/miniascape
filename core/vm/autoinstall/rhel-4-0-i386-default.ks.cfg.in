# RHEL 4 AS i386 - minimal package selection
url --url=@AUTOINST_TREE_URL_BASE@/rhel/4/0/as/i386/
install
text
lang en_US.UTF-8
langsupport --default=en_US.UTF-8 en_US.UTF-8
keyboard us
mouse genericwheelps/2 --device psaux
skipx
network --device=eth0 --bootproto=dhcp
network --device=eth1 --bootproto=dhcp --nodns
network --device=eth2 --bootproto=dhcp --nodns
network --device=eth3 --bootproto=dhcp --nodns
rootpw redhat
firewall --enabled --port=22:tcp
selinux --enforcing
authconfig --enableshadow --enablemd5
timezone Asia/Tokyo
bootloader --location=mbr
clearpart --all --initlabel
part /boot --fstype "ext3" --size=100
part pv.6 --size=0 --grow
volgroup VolGroup00 --pesize=32768 pv.6
logvol / --fstype ext3 --name=LogVol00 --vgname=VolGroup00 --size=1024 --grow
logvol swap --fstype swap --name=LogVol01 --vgname=VolGroup00 --size=496 --grow --maxsize=512
reboot


%pre
# Make up dummy lspci to avoid the anaconda bug similar to bz#445974.
cat << EOF > /sbin/lspci
#! /bin/sh
exit 0
EOF
chmod +x /sbin/lspci


%packages
@ admin-tools
@ text-internet
@ gnome-desktop
@ dialup
@ smb-server
@ base-x
@ web-server
@ printing
@ server-cfg
kernel
lvm2
grub
e2fsprogs


%post --nochroot
cp /tmp/ks.cfg /mnt/sysimage/root/


%post
# set gateway device expressly
cat << EOF >> /etc/sysconfig/network
GATEWAYDEV=eth0
EOF

# Hack to off eth1 and eth3; anaconda in rhel3/4 does not support
# "--onboot=<yes|no>" option for network command.
for f in /etc/sysconfig/network-scripts/ifcfg-eth{1,3}; do
    sed --in-place -e "s/^ONBOOT=yes/ONBOOT=no/" $f
    echo "PEERDNS=no" >> $f
done

# meaningless for virtulization guests
/sbin/chkconfig smartd off

rpm --import /usr/share/rhn/RPM-GPG-KEY

# Add local repo
sed --in-place -re 's/^(up2date default)/# \1/g' -e '$a\
dir rhel-kstree @AUTOINST_TREE_URL_BASE@/rhel/4/0/as/i386/' \
/etc/sysconfig/rhn/sources

cat << EOF >> /etc/inittab

# serial console:
co:2345:respawn:/sbin/agetty ttyS0 115200 vt100-nav
EOF

cat << EOF >> /etc/securetty
ttyS0
EOF
