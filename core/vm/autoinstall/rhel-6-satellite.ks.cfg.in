url --url=@AUTOINST_TREE_URL_BASE@/rhel/6/1/server/x86_64/
auth --useshadow --enablemd5
bootloader --location=mbr
clearpart --all --initlabel
text
# Satellite:
# SEE ALSO: http://www.redhat.com/docs/manuals/satellite/Red_Hat_Network_Satellite-5.2.0/html/Installation_Guide/s1-requirements-additional.html
firewall --enabled --ssh --http --port=443:tcp --port=5222:tcp --port=5269:tcp
firstboot --disable
keyboard us
lang en_US
network --device=eth0 --bootproto=dhcp
network --device=eth1 --bootproto=dhcp --onboot=no --nodns
network --device=eth2 --bootproto=dhcp --nodns
network --device=eth3 --bootproto=dhcp --onboot=no --nodns
rootpw redhat
selinux --permissive
skipx
timezone  Asia/Tokyo
install
zerombr
autopart
key --skip
services --disabled atd,cups,gpm,ip6tables,lm_sensors,mcstrans,mdmonitor,ntpd,restorecond,sendmail,smartd
reboot


%pre


%packages
# Automatic package selection.
@ Base
curl
elinks
lv
ntp
rpm-build
screen
strace
vim-enhanced
#
PyXML
alsa-lib
ant
antlr
apr
apr-util
axis
bcel
classpathx-jaf
classpathx-mail
compat-db
compat-libstdc++-33
distcache
eclipse-ecj
elfutils
elfutils-libs
gd
geronimo-specs
geronimo-specs-compat
#
gjdoc
httpd
jakarta-commons-beanutils
jakarta-commons-codec
jakarta-commons-collections
jakarta-commons-daemon
jakarta-commons-dbcp
jakarta-commons-digester
jakarta-commons-discovery
jakarta-commons-el
jakarta-commons-fileupload
jakarta-commons-httpclient
jakarta-commons-lang
jakarta-commons-launcher
jakarta-commons-logging
jakarta-commons-modeler
jakarta-commons-pool
jakarta-commons-validator
jakarta-oro
jakarta-taglibs-standard
java-1.4.2-gcj-compat
jdom
jpackage-utils
libXmu
libXp
libXpm
libXtst
libart_lgpl
libgcj
log4j
mod_perl
mod_python
mod_ssl
mx4j
newt-perl
perl-Archive-Tar
perl-BSD-Resource
perl-Compress-Zlib
perl-Convert-ASN1
perl-DBI
perl-DateManip
perl-Digest-HMAC
perl-Digest-SHA1
perl-HTML-Parser
perl-HTML-Tagset
perl-IO-Socket-SSL
perl-IO-Zlib
perl-Net-SSLeay
perl-TimeDate
perl-URI
perl-XML-Dumper
perl-XML-LibXML
perl-XML-LibXML-Common
perl-XML-NamespaceSupport
perl-XML-Parser
perl-XML-SAX
perl-libwww-perl
pkgconfig
postgresql-libs
regexp
rpm-build
struts
tomcat5
tomcat5-common-lib
tomcat5-jasper
tomcat5-jsp-2.0-api
tomcat5-server-lib
tomcat5-servlet-2.4-api
wsdl4j
xalan-j2
xerces-j2
xml-commons
xml-commons-apis
xml-commons-resolver
# required since satelllite-5.3.0
createrepo
mkisofs
python-devel
tftp-server
xinetd
#
-Deployment_Guide-en-US
-NetworkManager
-OpenIPMI
-OpenIPMI-libs
-acpid
-amtu
-apmd
-aspell
-aspell-en
-bluez-gnome
-bluez-libs
-bluez-utils
-ccid
-conman
-coolkey
-cpuspeed
-dos2unix
-eject
-fbset
-finger
-ftp
-hdparm
-ifd-egate
-irda-utils
-irqbalance
-krb5-workstation
-microcode_ctl
-mozldap
-nano
-pam_pkcs11
-pam_ccreds
-pam_smb
-pcmciautils
-pcsc-lite
-ppp
-psacct
-rdate
-rdist
-redhat-release-notes-5Server
-rp-pppoe
-rsh
-specspo
-stunnel
-talk
-telnet
-udftools
-unix2dos
-wpa_supplicant
-yum-updatesd


%post --nochroot
cp /tmp/ks.cfg /mnt/sysimage/root/


%post
cat << EOF >> /etc/sysconfig/network
GATEWAYDEV=eth0
EOF

rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release

cat << EOF > /etc/yum.repos.d/rhel-kstree.repo
[rhel-kstree]
name=Red Hat Enterprise Linux \$releasever - \$basearch - Server (kickstart tree)
baseurl=@AUTOINST_TREE_URL_BASE@/rhel/6/1/server/x86_64/Server/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF


## satellite specific
cd /root

#curl -O @AUTOINST_TREE_URL_BASE@/RHEL-5-Satellite/5.4.0/i386/Satellite-5.4.0-RHEL5-re20101025.0-i386-embedded-oracle.iso
#ln -s satellite-embedded-oracle-5.4.1-20110615-rhel-6-x86_64.iso satellite.iso

cat <<EOA > answers.txt
admin-email = foo@example.com
#rhn-username =
#rhn-password =
ssl-set-org = Example, Inc.
ssl-set-org-unit = IT
ssl-set-city = Shibuya-ku
ssl-set-state = Tokyo
ssl-set-country = JP
ssl-password = redhat
ssl-set-email = foo@example.com
## NOTE: You need to get a satellite certificate and put it on this path.
satellite-cert-file = /root/satellite.cert
EOA

cat << EOF >> /etc/inittab

# serial console:
co:2345:respawn:/sbin/agetty ttyS0 115200 vt100-nav
EOF


cat << EOF >> /etc/securetty
ttyS0
EOF

%end
