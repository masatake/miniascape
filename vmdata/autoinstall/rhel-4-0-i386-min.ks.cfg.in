# RHEL 4 AS i386 - minimal package selection
url --url=@AUTOINST_TREE_URL_BASE@/RHEL/4/0/AS/i386/
install
text
lang en_US.UTF-8
langsupport --default=en_US.UTF-8 en_US.UTF-8
keyboard us
mouse genericwheelps/2 --device psaux
skipx
network --device=eth0 --bootproto=dhcp
network --device=eth1 --bootproto=dhcp --nodns
network --device=eth2 --bootproto=dhcp --nodns
network --device=eth3 --bootproto=dhcp --nodns
rootpw --iscrypted $1$u3qutDHb$7APw4U/78XZW44uPsoNa41
firewall --enabled --port=22:tcp
selinux --enforcing
authconfig --enableshadow --enablemd5
timezone Asia/Tokyo
bootloader --location=mbr
clearpart --all --initlabel
part /boot --fstype "ext3" --size=100
part pv.6 --size=0 --grow
volgroup VolGroup00 --pesize=32768 pv.6
logvol / --fstype ext3 --name=LogVol00 --vgname=VolGroup00 --size=1024 --grow
logvol swap --fstype swap --name=LogVol01 --vgname=VolGroup00 --size=496 --grow --maxsize=512
reboot


%pre
# Make up dummy lspci to avoid the anaconda bug similar to bz#445974.
cat << EOF > /sbin/lspci
#! /bin/sh
exit 0
EOF
chmod +x /sbin/lspci


%packages
@ base
curl
elinks
ntp
screen
strace
vim-enhanced
-acpid
-apmd
-aspell
-aspell-en
-bluez-bluefw
-bluez-hcidump
-bluez-libs
-bluez-utils
-compat-libstdc++-33
-comps
-dapl
-dos2unix
-eject
-finger
-ftp
-guile
-ibutils
-ibutils-libs
-ipsec-tools
-irda-utils
-isdn4k-utils
-mgetty
-minicom
-mtr
-mt-st
-nano
-NetworkManager
-pam_krb5
-pam_smb
-pcmcia-cs
-pdksh
-ppp
-quota
-rdate
-rdist
-rp-pppoe
-rsh
-specspo
-swig
-system-config-mouse
-talk
-telnet
-umb-scheme
-wireless-tools
-wpa_supplicant
-wvdial
-xmlsec1
-xmlsec1-openssl


%post --nochroot
cp /tmp/ks.cfg /mnt/sysimage/root/


%post
# set gateway device expressly
cat << EOF >> /etc/sysconfig/network
GATEWAYDEV=eth0
EOF

# Hack to off eth1 and eth3; anaconda in rhel3/4 does not support
# "--onboot=<yes|no>" option for network command.
for f in /etc/sysconfig/network-scripts/ifcfg-eth{1,3}; do
    sed --in-place -e "s/^ONBOOT=yes/ONBOOT=no/" $f
done

# meaningless for virtulization guests
/sbin/chkconfig smartd off

rpm --import /usr/share/rhn/RPM-GPG-KEY

# Add local repo
sed --in-place -re 's/^(up2date default)/# \1/g' -e '$a\
dir rhel-kstree @AUTOINST_TREE_URL_BASE@/RHEL/4/0/AS/i386/' \
/etc/sysconfig/rhn/sources

